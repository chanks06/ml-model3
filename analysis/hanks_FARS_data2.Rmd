---
title: "Predicting Presence of Alcohol in Fatal Vehicle Incidents"
output: pdf_document
date: "2023-04-05"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = '/Users/charleshanks/desktop/msds/spring_23/ml/FARS2020NationalCSV')
```

This data comes from the National Highway Traffic Safety Administration (NHTSA). We going to build a model to predict if alcohol played a factor in fatal vehicle incidents in 2020. This type of model could be used to find patterns in types of crashes, and to make changes to certain roads or intersection areas where alcohol-related vehicular manslaughter are prevalent.

"While the number of crashes and traffic injuries declined overall,  fatal crashes increased by 6.8%. The fatality rate per 100 million vehicle miles traveled increased to 1.34, a 21% increase from 2019 and the highest since 2007."

```{r}
library(tidyverse)
library(tidytext)
library(caret)
library(fastDummies)
library(randomForest)

acc = read_csv('accident.csv')  
veh = read_csv('vehicle.csv')
per = read_csv('person.csv')
dru = read_csv('drugs.csv')
```

```{r}
#drivers only: 
drivers = per %>% filter(PER_TYP == 1)

```
Which variables are of interest for supervised learning? 

## PERSON dataset

*AGE (numeric)
SEX (factor )
ST_CASE (for joining) 
INJ_SEV (injury severity, factor -- (no injury), 0-9)
REST_USE (type of restraint system used) 
RES_MIS (identifies any misuses of restraint )
AIR_BAG (was the airbag deployed)
EJECTION (were they ejected from the vehicle)
EJ_PATH (how they were ejected from the vehicle)
EXTRICAT (was equipment used to extricate the person from the vehicle)
DRINKING (did police report alcohol involvement )
DRUGS (did police report if drugs were involved)
DOA (died on scene/en route)

## ACCIDENT dataset 

*VE_FORMS (number of vehicles involved in the crash, parked cars not included)
*PVH_INVL (number of parked or working vehicles involved in the crash)
COUNTY (the county where this occured, GSA geographical code)
CITY (GSA geographical code)
*MONTH (1-12)
*DAY (1-31)
DAY_WEEK (1-7, or -- unknown)
*HOUR (0-23, or 99 unknown)
RUR_URB (rural or urban land)
SP_JUR (military, reservation, college campus)
*LATITUDE
*LONGITUD
HARM_EV (first injury or damage producing event)
MAN_COLL (manner of collision, e.g. sideswipe, rear-to-side)
RELJCT2 (type of junction, e.g. interesection, driveway, off ramp)
TYP_INT (type of intersection)
REL_ROAD (where did it happen on road)
WRK_ZONE (did it happen in a construction zone)
LGT_COND (how light was it outside)
WEATHER (atmospheric conditions)
*FATALS (number of fatalities in crash)

DRUNK_DR (number of drinking drivers involved in the fatal car crash, it says this variable was discontinued in 2015....)

## VEHICLE dataset 

ST_CASE (to merge with accident data)
ST_CASE and VEH_NO (to merge with vehicle data and person data)
HIT_RUN (if >0, some sort of hit and run)
IMPACT1 (where on car did it hit first object)
ROLLOVER (type of rollover if any)
DEFORMED (how bad is the damage)
DEATHS 
M_HARM (event that resulted in the most severe injury)
DRINKING (0 = no drinking, 1 = drinking)
*DR_HGT (actual heightin inches 24 - 107)
*DR_WGT (actual weigth in pounds)
*PREV_ACC (previously recorded crashes within the last 5 years)
*PREV_DWI (number of previous DWI convictions within last 5 years)
*PREV_SPD (number of previous speeding conviction within last 5 years)
*PREV_OTH (number of any other previous moving violations or conviction in last 5 years)
P_CRASH3 (type of critical precrash event)
*ACC_TYPE (type of crash)

```{r}
?inner_join()

drivers %>% right_join(per, by = c('ST_CASE','VEH_NO')) %>%  filter(ST_CASE == 10001)

veh %>% select(ST_CASE, VEH_NO) %>% filter(ST_CASE == 10001)

acc %>% filter(ST_CASE == 10001)


#this is good one: this is very vehicle involved in each 
every_veh_per_acc = acc %>% right_join(veh, by = 'ST_CASE')  
  
#there were 54,552 vehicles in fatal accidents in 2020  
  
every_veh_per_acc %>% select(starts_with('DR')) %>% group_by(DR_DRINK) %>% count() %>% mutate(prop = n/nrow(every_veh_per_acc))
#18 percent of these drivers were drinking. 

#okay this is vehicle joined with accident and drivers
every_veh_per_acc %>% left_join(drivers, by = c('ST_CASE','VEH_NO')) %>% group_by(ST_CASE,VEH_NO,PER_NO)
```

## CRASHRF dataset 


## MANEUVER dataset 
use ST_CASE and VEH_NO to merge with vehicle dataset 
MANEUVER (what driver avoided)
